 name: Deploy Frontend

  on:
    push:
      branches: [main]
      paths: ['src/**', 'package.json']

  jobs:
    deploy:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v3

        - uses: actions/setup-node@v3
          with:
            node-version: '20'

        - run: npm install && npm run build

        - name: Deploy via SCP
          uses: appleboy/scp-action@master
          with:
            host: ${{ secrets.SERVER_HOST }}
            username: ${{ secrets.SERVER_USER }}
            key: ${{ secrets.SERVER_SSH_KEY }}
            source: "dist/"
            target: "/srv/mobimap-stem/"

        - name: Restart Caddy
          uses: appleboy/ssh-action@master
          with:
            host: ${{ secrets.SERVER_HOST }}
            username: ${{ secrets.SERVER_USER }}
            key: ${{ secrets.SERVER_SSH_KEY }}
            script: docker-compose restart caddy
